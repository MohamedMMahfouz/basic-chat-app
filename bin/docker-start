#!/bin/sh

set -x

chmod 755 bin/wait-for-it.sh

echo 'Waiting for MySQL...'

./bin/wait-for-it.sh -t 0 db:3306

echo "MySQL is up and running!"

echo "Elasticsearch is not ready, sleeping..."

./bin/wait-for-it.sh -t 0 elasticsearch:9200

echo "Elasticsearch is ready, starting Rails."

rm /rails/tmp/pids/server.pid

# setup database and start puma
RAILS_ENV=development bundle exec rake db:create
RAILS_ENV=development bundle exec rake db:migrate
RAILS_ENV=development bundle exec rails s -p 3000 -b '0.0.0.0'